<div class="modal-container" cdkDrag>
  <div class="modal-header" cdkDragHandle>
    <h5 class="modal-title">{{ modalTitle }}</h5>
    <app-modal-close></app-modal-close>
  </div>
  <div class="modal-body">
    <app-loading-modal class='large' *ngIf="!loaded"></app-loading-modal>
    <form [formGroup]="licenseForm" class="form-container" (keydown)="keyDownFunction($event)" *ngIf="loaded">
      <div class="row">
        <div class="col-4">
          <div class="form-label-group">
            <input
              id="licenseNumber"
              class="form-control input-control required"
              placeholder="CDL number"
              formControlName="licenseNumber"
              oninput="this.value = this.value.replace(/[ ]|^ /g,'')"
              (paste)="onPaste($event, 'licenseNumber', 17)"
              (keypress)="onLicenseNumberTyping($event)"
              maxlength="17"
              appAutoFocus
              [modalType]="inputData.data.type"
            />
            <label class="required-label" for="licenseNumber">CDL number</label>
            <app-required-label
              [control]="licenseForm.controls.licenseNumber"
            ></app-required-label>
          </div>
        </div>
        <div class="col-4">
          <div class="form-label-group">
            <kendo-floatinglabel
              text="Issue date"
              class="required datepicker-label{{
                licenseForm.controls.licenseStartDate.value !== null &&
                licenseForm.controls.licenseStartDate.value !== ''
                  ? ' valid-label'
                  : ''
              }}"
            >
              <kendo-datepicker
                #startDate
                placeholder=""
                [max]="endDate.value"
                [format]="format"
                [formatPlaceholder]="{
                  year: 'yy',
                  month: 'mm',
                  day: 'dd'
                }"
                formControlName="licenseStartDate"
                required
                [popupSettings]="{ popupClass: 'custom-datepick' }"
              ></kendo-datepicker>
            </kendo-floatinglabel>
            <app-required-label
              [control]="licenseForm.controls.licenseStartDate"
            ></app-required-label>
          </div>
        </div>
        <div class="col-4">
          <div class="form-label-group">
            <kendo-floatinglabel
              text="Exp. date"
              class="required datepicker-label{{
                licenseForm.controls.licenseEndDate.value !== null &&
                licenseForm.controls.licenseEndDate.value !== ''
                  ? ' valid-label'
                  : ''
              }}"
            >
              <kendo-datepicker
                #endDate
                placeholder=""
                [min]="startDate.value"
                formControlName="licenseEndDate"
                [format]="format"
                [formatPlaceholder]="{
                  year: 'yy',
                  month: 'mm',
                  day: 'dd'
                }"
                required
                [popupSettings]="{ popupClass: 'custom-datepick' }"
              ></kendo-datepicker>
            </kendo-floatinglabel>
            <app-required-label
              [control]="licenseForm.controls.licenseEndDate"
            ></app-required-label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-4">
          <div class="form-label-group">
            <ng-select
              [items]="classData"
              formControlName="class"
              placeholder="License class"
              bindLabel="value"
              placeholder="Class"
              class="required-field"
              appendTo="body"
            >
              <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{ item.value }}</span>
              </ng-template>
            </ng-select>
            <app-required-label [control]="licenseForm.controls.class"></app-required-label>
          </div>
        </div>
        <div class="col-4">
          <div class="form-label-group">
            <ng-select
              [items]="countryData"
              formControlName="country"
              placeholder="Country"
              bindLabel="value"
              (change)="getStatesLicense($event)"
              class="required-field"
              appendTo="body"
            >
              <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{ item.value }}</span>
              </ng-template>
            </ng-select>
            <app-required-label [control]="licenseForm.controls.country"></app-required-label>
          </div>
        </div>
        <div class="col-4">
          <div class="form-label-group">
            <ng-select
              [items]="stateData"
              formControlName="state"
              placeholder="State"
              bindLabel="key"
              class="required-field"
              appendTo="body"
            >
              <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <svg-icon
                  src="assets/img/svgs/states/{{ item.value }}.svg"
                  [svgStyle]="{ 'width.px': 20, 'height.px': 20 }"
                  class="select-dropdown-image"
                ></svg-icon>
                <span [ngOptionHighlight]="search">{{ item.key }}</span>
              </ng-template>

              <ng-template ng-label-tmp let-item="item">
                <div class="value-label-container state-value-label">
                  <svg-icon
                    src="assets/img/svgs/states/{{ item.value }}.svg"
                    [svgStyle]="{ 'width.px': 20, 'height.px': 20 }"
                    class="select-dropdown-image"
                  ></svg-icon>
                  <span>{{ item.key }}</span>
                </div>
              </ng-template>
            </ng-select>
            <app-required-label [control]="licenseForm.controls.state"></app-required-label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="form-label-group">
            <ng-select
              [items]="restrictionData"
              [multiple]="true"
              bindLabel="restrictionName"
              [closeOnSelect]="false"
              [hideSelected]="true"
              formControlName="restrictions"
              placeholder="Restrictions"
              [dropdownPosition]="'bottom'"
              (change)="selectRestriction($event)"
              appendTo="body"
            >
              <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{ item.restrictionName }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12">
          <div class="form-label-group">
            <ng-select
              [items]="endorsementData"
              [multiple]="true"
              bindLabel="endorsementName"
              [closeOnSelect]="false"
              [hideSelected]="true"
              formControlName="endorsements"
              placeholder="Endorsments"
              [dropdownPosition]="'bottom'"
              appendTo="body"
            >
              <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <span [ngOptionHighlight]="search">{{ item.endorsementName }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
      </div>

      <app-attachments page='cdl' (filesChanged)="setFiles($event)" [attachments]="attachments"></app-attachments>

      <div class="row">
        <div class="col-12 note-wrapper{{ showNote ? ' visible-note' : ' hidden-note' }}">
          <div class="note-label-wrapper" (click)="openNote()">
            <span class="note-label">Note</span>
            <svg-icon
              src="assets/img/svgs/down-arrow.svg"
              class="down-icon"
            ></svg-icon>
          </div>
          <div class="example-full-width note-input{{ showNote ? ' note-visible' : ' note-hidden' }}">
              <textarea
                cdkTextareaAutosize
                #note
                cdkAutosizeMinRows="2"
                cdkAutosizeMaxRows="5"
                formControlName="note"
                class="input-custom-textarea form-textarea"
              ></textarea>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="cancel-btn" data-dismiss="modal" (click)="closeModal()">
      Cancel
    </button>
    <button type="button" class="save-btn" (click)="editLicense(false)">Save</button>
  </div>
</div>
